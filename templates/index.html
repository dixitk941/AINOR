<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A.I.N.O.R - Voice Assistant</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <style>
body {
    font-family: 'Roboto', sans-serif;
    background-color: #000000;
    color: #ffffff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;
    height: 100vh;
    margin: 0;
    padding: 20px;
    overflow: hidden;
}

.branding {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 1.2em;
    color: #ffffff;
    background-color: rgba(255, 255, 255, 0.1);
    padding: 10px 20px;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
}

.chat-container {
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 600px;
    height: calc(100vh - 160px);
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
    overflow-y: auto;
    padding: 20px;
}

.message {
    margin-bottom: 20px;
    padding: 15px;
    border-radius: 10px;
    background-color: rgba(255, 255, 255, 0.1);
    word-wrap: break-word;
    font-size: 1em;
    max-width: 70%;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
    animation: fadeIn 0.5s ease-in-out;
    position: relative;
}

.message.code {
    background-color: rgba(255, 255, 255, 0.2);
    padding: 15px;
    border-radius: 5px;
    overflow-x: auto;
}

.message.user {
    align-self: flex-end;
    background-color: rgba(255, 255, 255, 0.2);
}

.message.ai {
    align-self: flex-start;
}

.input-container {
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 600px;
    margin-top: 20px;
}

.input-row {
    display: flex;
    width: 100%;
}

#command {
    flex-grow: 1;
    padding: 15px;
    border: none;
    border-radius: 25px;
    outline: none;
    background-color: rgba(255, 255, 255, 0.1);
    color: #ffffff;
    font-size: 1em;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
}

#submit {
    padding: 15px 20px;
    margin-left: 10px;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    background-color: rgba(255, 255, 255, 0.1);
    color: #ffffff;
    font-size: 1em;
    transition: background-color 0.3s, transform 0.3s;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
}

#submit:hover {
    background-color: rgba(255, 255, 255, 0.2);
    transform: scale(1.05);
}

.disclaimer {
    margin-top: 10px;
    font-size: 0.8em;
    color: #bbbbbb;
    text-align: center;
}

.copy-button {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 5px 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    background-color: rgba(255, 255, 255, 0.2);
    color: #ffffff;
    font-size: 0.8em;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@media (max-width: 600px) {
    .branding {
        font-size: 1em;
        padding: 8px 16px;
    }

    .chat-container {
        height: calc(100vh - 140px);
        padding: 15px;
    }

    .message {
        font-size: 0.9em;
        padding: 10px;
    }

    .input-container {
        margin-top: 15px;
    }

    #command {
        padding: 10px;
        font-size: 0.9em;
    }

    #submit {
        padding: 10px 15px;
        font-size: 0.9em;
    }

    .disclaimer {
        font-size: 0.7em;
    }

    .copy-button {
        font-size: 0.7em;
        padding: 4px 8px;
    }
}

@media (max-width: 400px) {
    .branding {
        font-size: 0.9em;
        padding: 6px 12px;
    }

    .chat-container {
        height: calc(100vh - 120px);
        padding: 10px;
    }

    .input-container {
        margin-top: 10px;
    }

    #command {
        padding: 8px;
        font-size: 0.8em;
    }

    #submit {
        padding: 8px 12px;
        font-size: 0.8em;
    }

    .disclaimer {
        font-size: 0.6em;
    }

    .copy-button {
        font-size: 0.6em;
        padding: 3px 6px;
    }
}

    </style>
</head>
<body>
    <div class="branding">AINOR Powered By GEMINI 1.5</div>
    <div class="chat-container" id="chatContainer">
        <!-- Messages will be appended here -->
    </div>
    <div class="input-container">
        <div class="input-row">
            <input type="text" id="command" placeholder="Enter your command...">
            <button id="submit">Send</button>
        </div>
        <div class="disclaimer">AINOR can make mistakes. Check important info.</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-javascript.min.js"></script>
    <script>
        document.getElementById('submit').onclick = function() {
            var command = document.getElementById('command').value;
            addMessage(command, 'user');
            processCommand(command);
        };

        document.getElementById('command').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                document.getElementById('submit').click();
            }
        });

        function addMessage(text, sender) {
            const message = document.createElement('div');
            message.className = `message ${sender}`;
            message.innerHTML = formatMessage(text);
            document.getElementById('chatContainer').appendChild(message);
            document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
        }

        function formatMessage(text) {
            // Replace **text** with <strong>text</strong>
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            // Replace ```language code ``` with <pre><code>code</code></pre>
            text = text.replace(/```(\w+)\s*([\s\S]*?)\s*```/g, function(match, lang, code) {
                const pre = document.createElement('pre');
                const codeElement = document.createElement('code');
                codeElement.className = `language-${lang}`;
                codeElement.textContent = code;
                pre.appendChild(codeElement);
                Prism.highlightElement(codeElement);

                const copyButton = document.createElement('button');
                copyButton.className = 'copy-button';
                copyButton.innerText = 'Copy';
                copyButton.onclick = function() {
                    navigator.clipboard.writeText(code).then(function() {
                        alert('Code copied to clipboard!');
                    }, function(err) {
                        alert('Failed to copy code: ', err);
                    });
                };
                pre.appendChild(copyButton);

                return pre.outerHTML;
            });

            return text;
        }

        function processCommand(command) {
            fetch('/process_command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ command: command })
            })
            .then(response => response.json())
            .then(data => {
                // Clear input
                document.getElementById('command').value = '';

                // Create message elements
                const textResponse = data.response;
                const codeSnippet = data.code;

                if (textResponse) {
                    addMessage(textResponse, 'ai');
                }

                if (codeSnippet) {
                    const codeMessage = document.createElement('pre');
                    codeMessage.className = 'message code ai language-javascript';
                    codeMessage.innerText = codeSnippet;
                    document.getElementById('chatContainer').appendChild(codeMessage);
                    Prism.highlightElement(codeMessage);

                    const copyButton = document.createElement('button');
                    copyButton.className = 'copy-button';
                    copyButton.innerText = 'Copy';
                    copyButton.onclick = function() {
                        navigator.clipboard.writeText(codeSnippet).then(function() {
                            alert('Code copied to clipboard!');
                        }, function(err) {
                            alert('Failed to copy code: ', err);
                        });
                    };
                    codeMessage.appendChild(copyButton);
                }

                // Scroll to the bottom of the chat container
                document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </script>
</body>
</html>